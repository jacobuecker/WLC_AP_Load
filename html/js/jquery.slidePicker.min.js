/*
 *   jQuery Slide Picker Plugin
 *   Copyright (c) 2012 Lance Ingle
 *   www.lanceingle.com
 *   http://github.com/
 *   http://www.lanceingle.com/blog/
 *
 *   @author      Lance Ingle <lance.ingle@gmail.com>
 *   @license     MIT
 *
 */
(function(a){a.fn.slidePicker=function(b){function f(a){a.context.clearRect(0,0,a.divWidth,a.divHeight);var b=0;var c=0;if(a.mousePos!=null){if(a.opts.sliderOptions.lockedWindow){if(a.lockGrab=="left"){b=a.mousePos.x;c=b+a.lockDiff;a.rightDragging=true}else if(a.lockGrab=="right"){c=a.mousePos.x;b=c-a.lockDiff;a.leftDragging=true}}else{b=a.mousePos.x;c=a.mousePos.x}}k(a);m(a);j(a,b,c);l(a)}function g(a){if(a.data.sliderObj.mousePos!=null){if(a.data.sliderObj.opts.sliderOptions.lockedWindow){if(a.data.sliderObj.lockGrab=="left"){var b=o(a,a.data.sliderObj.mousePos.x);var c=o(a,a.data.sliderObj.opts.data[b].xCord+a.data.sliderObj.lockDiff);a.data.sliderObj.leftSlider=b;a.data.sliderObj.rightSlider=c}else if(a.data.sliderObj.lockGrab=="right"){var c=o(a,a.data.sliderObj.mousePos.x);var b=o(a,a.data.sliderObj.opts.data[c].xCord-a.data.sliderObj.lockDiff);a.data.sliderObj.leftSlider=b;a.data.sliderObj.rightSlider=c}var d=a.data.sliderObj.opts.data[a.data.sliderObj.leftSlider].timestamp;var e=a.data.sliderObj.opts.data[a.data.sliderObj.rightSlider].timestamp;a.data.sliderObj.opts.rangeChange({start:d,stop:e});a.data.sliderObj.leftDragging=!a.data.sliderObj.leftDragging;a.data.sliderObj.rightDragging=!a.data.sliderObj.rightDragging;a.data.sliderObj.lockGrab="none";a.data.sliderObj.mousePos=null}else{var g=o(a,a.data.sliderObj.mousePos.x);var h=false;if(a.data.sliderObj.leftDragging||a.data.sliderObj.rightDragging){h=true}if(a.data.sliderObj.leftDragging){a.data.sliderObj.leftSlider=g;a.data.sliderObj.leftDragging=!a.data.sliderObj.leftDragging}if(a.data.sliderObj.rightDragging){if(g>a.data.sliderObj.opts.data.length){g=a.data.sliderObj.data.length}else{g--}a.data.sliderObj.rightSlider=g;a.data.sliderObj.rightDragging=!a.data.sliderObj.rightDragging}if(h){f(a.data.sliderObj);var d=a.data.sliderObj.opts.data[a.data.sliderObj.leftSlider].timestamp;var e=a.data.sliderObj.opts.data[a.data.sliderObj.rightSlider].timestamp;a.data.sliderObj.opts.rangeChange({start:d,stop:e})}a.data.sliderObj.mousePos=null}}}function h(a){var b=r(a);if(a.data.sliderObj.leftDragging){if(b.x<=a.data.sliderObj.opts.data[a.data.sliderObj.rightSlider].xCord){a.data.sliderObj.mousePos=b}}if(a.data.sliderObj.rightDragging){if(b.x>=a.data.sliderObj.opts.data[a.data.sliderObj.leftSlider].xCord){a.data.sliderObj.mousePos=b}}f(a.data.sliderObj)}function i(a){var b=r(a);var c=p(a,b);if(c.yes){if(c.which=="left"){a.data.sliderObj.leftDragging=true}if(c.which=="right"){a.data.sliderObj.rightDragging=true}}}function j(a,b,c){if(a.opts.sliderOptions.lockedWindow){if(a.lockGrab=="left"){if(b+a.lockDiff>=a.divWidth-a.gutter){b=a.divWidth-a.gutter-a.lockDiff}}else if(a.lockGrab=="right"){if(c-a.lockDiff<=a.gutter){c=a.gutter+a.lockDiff}}}var d=s(a.opts.sliderOptions.colorOverlay);a.context.fillStyle="rgba("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")";if(a.leftDragging){if(b<a.gutter){b=a.gutter}a.context.fillRect(a.gutter,a.gutter,b-a.gutter,a.divHeight-a.gutter*2);if(a.opts.sliderOptions.imgPos=="bottom"){a.context.drawImage(a.sliderImage,b-a.sliderImage.width/2,a.divHeight-a.gutter-a.sliderImage.width/2)}else if(a.opts.sliderOptions.imgPos=="middle"){a.context.drawImage(a.sliderImage,b-a.sliderImage.width/2,a.divHeight/2-a.sliderImage.height/2)}else{a.context.drawImage(a.sliderImage,b-a.sliderImage.width/2,a.gutter-a.sliderImage.height/2)}var e=Math.round((b-a.gutter)/a.barWidthMult);if(e>=0){a.opts.startChange(a.opts.data[e].timestamp)}}else{a.context.fillRect(0+a.gutter,0+a.gutter,a.opts.data[a.leftSlider].xCord-a.gutter,a.divHeight-a.gutter*2);if(a.opts.sliderOptions.imgPos=="bottom"){a.context.drawImage(a.sliderImage,a.opts.data[a.leftSlider].xCord-a.sliderImage.width/2,a.divHeight-a.gutter-a.sliderImage.width/2)}else if(a.opts.sliderOptions.imgPos=="middle"){a.context.drawImage(a.sliderImage,a.opts.data[a.leftSlider].xCord-a.sliderImage.width/2,a.divHeight/2-a.sliderImage.height/2)}else{a.context.drawImage(a.sliderImage,a.opts.data[a.leftSlider].xCord-a.sliderImage.width/2,a.gutter-a.sliderImage.width/2)}}if(a.rightDragging){if(c>a.divWidth-a.gutter){c=a.divWidth-a.gutter}a.context.fillRect(c,a.gutter,a.divWidth-a.gutter-c,a.divHeight-a.gutter*2);if(a.opts.sliderOptions.imgPos=="bottom"){a.context.drawImage(a.sliderImage,c-a.sliderImage.width/2,a.divHeight-a.gutter-a.sliderImage.width/2)}else if(a.opts.sliderOptions.imgPos=="middle"){a.context.drawImage(a.sliderImage,c-a.sliderImage.width/2,a.divHeight/2-a.sliderImage.height/2)}else{a.context.drawImage(a.sliderImage,c-a.sliderImage.width/2,a.gutter-a.sliderImage.width/2)}var e=Math.round((c-a.gutter)/a.barWidthMult);if(e<=a.opts.data.length-1){a.opts.stopChange(a.opts.data[e].timestamp)}}else{a.context.fillRect(a.opts.data[a.rightSlider].xCord+a.barWidthMult,a.gutter,a.divWidth-a.gutter-(a.opts.data[a.rightSlider].xCord+a.barWidthMult),a.divHeight-a.gutter*2);if(a.opts.sliderOptions.imgPos=="bottom"){a.context.drawImage(a.sliderImage,a.opts.data[a.rightSlider].xCord+a.barWidthMult-a.sliderImage.width/2,a.divHeight-a.gutter-a.sliderImage.width/2)}else if(a.opts.sliderOptions.imgPos=="middle"){a.context.drawImage(a.sliderImage,a.opts.data[a.rightSlider].xCord+a.barWidthMult-a.sliderImage.width/2,a.divHeight/2-a.sliderImage.height/2)}else{a.context.drawImage(a.sliderImage,a.opts.data[a.rightSlider].xCord+a.barWidthMult-a.sliderImage.width/2,a.gutter-a.sliderImage.width/2)}}}function k(a){a.context.strokeStyle=a.opts.graphOptions.border.color;a.context.lineWidth=a.opts.graphOptions.border.width;a.context.strokeRect(0+a.gutter,0+a.gutter,a.divWidth-a.gutter*2,a.divHeight-a.gutter*2)}function l(a){if(a.opts.graphOptions.showLabels){a.context.font="17px serif";a.context.fillStyle="#787878";for(var b=0;b<5;b++){var c=b*.25;var d=String(a.opts.data[Math.round((a.opts.data.length-1)*c)].timestamp);var e=a.context.measureText(d);if(c<.25){a.context.fillText(d,a.opts.data[Math.round((a.opts.data.length-1)*c)].xCord,a.divHeight)}else if(c>.75){a.context.fillText(d,a.opts.data[Math.round((a.opts.data.length-1)*c)].xCord-e.width,a.divHeight)}else{a.context.fillText(d,a.opts.data[Math.round((a.opts.data.length-1)*c)].xCord-e.width/2,a.divHeight)}a.context.strokeStyle="#787878";a.context.lineWidth=2;a.context.beginPath();a.context.moveTo(a.opts.data[Math.round((a.opts.data.length-1)*c)].xCord,a.divHeight-a.gutter);a.context.lineTo(a.opts.data[Math.round((a.opts.data.length-1)*c)].xCord,a.divHeight-a.gutter+5);a.context.stroke();a.context.closePath()}}}function m(a){a.context.fillStyle=a.opts.graphOptions.barColor;for(var b=0;b<a.opts.data.length;b++){var c=a.divHeight-a.gutter-a.opts.data[b].val*a.barHeightMult;var d=a.barWidthMult*b+a.gutter;if(a.opts.data[b].xCord==undefined){a.opts.data[b].xCord=d}a.context.fillRect(d,c,a.barWidthMult,a.divHeight-a.gutter-c)}if(a.opts.sliderOptions.lockedWindow&&a.lockDiff==0){a.lockDiff=a.opts.data[a.rightSlider].xCord-a.opts.data[a.leftSlider].xCord}}function n(a){}function o(a,b){return Math.round((b-a.data.sliderObj.gutter)/a.data.sliderObj.barWidthMult)}function p(a,b){var c={yes:false,which:"none"};if(b.x>=a.data.sliderObj.opts.data[a.data.sliderObj.leftSlider].xCord-10&&b.x<=a.data.sliderObj.opts.data[a.data.sliderObj.leftSlider].xCord+10&&b.y<=a.data.sliderObj.divHeight-a.data.sliderObj.gutter+10&&b.y>=a.data.sliderObj.gutter-10){c.which="left";c.yes=true;if(a.data.sliderObj.opts.sliderOptions.lockedWindow){a.data.sliderObj.lockGrab="left"}}if(b.x>=a.data.sliderObj.opts.data[a.data.sliderObj.rightSlider].xCord+a.data.sliderObj.barWidthMult-10&&b.x<=a.data.sliderObj.opts.data[a.data.sliderObj.rightSlider].xCord+a.data.sliderObj.barWidthMult+10&&b.y<=a.data.sliderObj.divHeight-a.data.sliderObj.gutter+10&&b.y>=a.data.sliderObj.gutter-10){c.which="right";c.yes=true;if(a.data.sliderObj.opts.sliderOptions.lockedWindow){a.data.sliderObj.lockGrab="right"}}return c}function q(a,b){for(var c=0;c<a.length;c++){if(a[c].timestamp==b){return c}}return null}function r(a){var b,c=null;if(a.offsetX==undefined){b=a.pageX-a.data.sliderObj.canvas.offset().left;c=a.pageY-a.data.sliderObj.canvas.offset().top}else{b=a.offsetX;c=a.offsetY}return{x:b,y:c}}function s(a){if(a.charAt(0)=="#"){a=a.slice(1);a=a.toUpperCase();var b="0123456789ABCDEF";var c=new Array(4);var d=0;var e,f;for(var g=0;g<6;g+=2){e=b.indexOf(a.charAt(g));f=b.indexOf(a.charAt(g+1));c[d]=e*16+f;d++}c[3]="0.30";return c}else if(a.toLowerCase().indexOf("rgba")==0){a=a.slice(5);a=a.slice(0,a.length-1);var h=a.split(",");var c=new Array(4);for(var g=0;g<a.length;g++){c[g]=String(h[g]).trim()}return c}else{return s("#0000ff")}}this.divHeight=this.height();this.divWidth=this.width();this.canvas=null;this.context=null;this.opts=a.extend(true,{},a.fn.slidePicker.defaults,b);this.barHeightMult=null;this.barWidthMult=null;this.leftSlider=null;this.rightSlider=null;this.gutter=this.opts.graphOptions.gutter;this.leftDragging=false;this.rightDragging=false;this.mousePos=null;this.rangeChange=null;this.startChange=null;this.stopChange=null;this.lockDiff=0;this.lockGrab="none";this.sliderImage=new Image;this.sliderImage.src=this.opts.sliderOptions.imgSrc;this.css({"-moz-user-select":"-moz-none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"});this.attr("unselecteable","on");this.html('<canvas width="'+this.divWidth+'" height="'+this.divHeight+'"></canvas>');this.canvas=a("canvas",this);this.context=this.canvas[0].getContext("2d");if(this.gutter<10){this.gutter=10}if(this.opts.graphOptions.showLabels&&this.gutter<20){this.gutter=20}if(this.opts.data.length>0){var c=Math.max.apply(Math,this.opts.data.map(function(a){return a.val}));this.barHeightMult=(this.divHeight-this.gutter*2)/(c+c*.1);this.barWidthMult=(this.divWidth-this.gutter*2)/this.opts.data.length}if(this.opts.sliderOptions.startSliderPos==0&&this.opts.sliderOptions.stopSliderPos==0){this.leftSlider=0;this.rightSlider=this.opts.data.length-1}else{var d=q(this.opts.data,this.opts.sliderOptions.startSliderPos);var e=q(this.opts.data,this.opts.sliderOptions.stopSliderPos);if(d!=null){this.leftSlider=d}else{this.leftSlider=0}if(e!=null){this.rightSlider=e}else{this.rightSlider=this.opts.data.length-1}}f(this);this.mousedown({sliderObj:this},i);this.mousemove({sliderObj:this},h);this.mouseup({sliderObj:this},g)};a.fn.slidePicker.defaults={data:[],sliderOptions:{imgPos:"top",imgSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAUCAMAAABYi/ZGAAAABGdBTUEAANbY1E9YMgAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAI0UExURcvW6+Tk5GhoaAAVZOXl5WWc0lib3HSm1HWn1L72/q3k/cb+/5/Z/YrH/Gys6tv+/6rj/UmN0Hy7+Y7K/M/+/0+MyJ7Z/UiLzgAVYwAVYgA9nyg4ca3l/efn53FxcZKSknV1dWtra8PDw0mMzpq837e3t8b8/pu933Kk1GCf28rV6xtouU2P0G2s6Q1csozJ/M3+/5XQ/He08Y3C6Via26zk/dD+/9P+/4S++Gie09n+/1iJxqji/YCHo4/L/GKYznuo13up1Zq83mee0i1FoWec0X2q1Vqc21WW1IjE/IvG/HR8mmif1ITA+uT+/3q69mqs6kiM0Gqf1V+e3MT6/oq96ABNqYzH/O7u7nZ/o3an1H27+Ulfr0WIy32r17ny/g1csISEhDN8xEyO0B84jmin5Ha08a7n/V+Xz7nx/nq7+W6Vu7GxsZvU/FiSzK/n/Zu+3x87j4Cr16ni/YzI/FeSzHGt55/Y/ZnV/Fmb2XKk0x9suk1/wXGj00qN0EOIzHyp1Wan5sn+/2eo55rU/Gt2nn28+Gqr6dPT05ir1Zi63Zm73nCs53yq1730/oCs2DuAxXi08ICt2ABMqHm49FaY2cDAwNf+/1eY1zyBxrzz/myt643K/Jq935e53Zu93n6r15Kk0lGS0lSX1b31/r3z/jR9xFqUznan1Wen5FiTzUeKzp3Y/WWd0mWk4G+UukaJzcvV6+jo6FiZ2Hq6+H+s2Gmf1Nr+/53X/Wmg1bOzs////7C23ZoAAAC8dFJOU/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8AAi4JawAAATpJREFUeNpU0MNiQ1EABNAkL7Zt1bZt27Zt27Ztu839uaY3yaKzmjnLQQEAAiRCBBGJEAQRSuKMGwVATviJLcqUl5n8CWgt/Ydaq+ajA6s5beisXzk0MS+kdTVyuHDpeOEjmCeGttZhnUvsJRCvCUTCQGMmNMfbCJzPJy715wEXH3ZVDK1vp0BzNzSYwmIJNM/LdtBKBdHbPVF4vDt+4+3s9BJaWdrjzRh9ai+ZPuJQYWMPrXp+ZT1pkp33zq6tdO0MglaXEEvjBO470TjtWTHeT9AUbt3f49R7PpXf1eCSoYCmVlb5S6XkJg8muY2pVEOT6VQUUs1F0e4i6Vylk0EDWAPGa1SfrqdwMQas6RcA0AbMl6cz1xdjQAOL/SFji2EmsxlRnig3k8UAdrOkHgv+G8iefrXUXwEGACYept3HxGHzAAAAAElFTkSuQmCC",colorOverlay:"#0000ff",startSliderPos:0,stopSliderPos:0,lockedWindow:false},graphOptions:{showLabels:true,barColor:"#A52A2A",gutter:20,border:{color:"#787878",width:1}},rangeChange:function(){},startChange:function(){},stopChange:function(){}}})(jQuery)